/**
 * Hai Form (https://github.com/safraja/hai-form) - Javascript library for custom inputs and selects with additional functions.
 * Copyright (c) 2021 Jakub Šafránek All Rights Reserved
 * @license MIT Licensed
 */
import{_ as e,a as t,b as i,c as a,d as s,e as l,HaiInput as n,f as r,g as d,h as o,i as c}from"./hai-input-class.esm.min.js";import"./en.esm.min.js";var m=function(m){e(f,n);var u,h=t(f);function f(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a(this,f),(e=h.call(this,t,i)).files=new Map,e.multiple=!1,e.maxFilesCount=null,e.maxFileSize=null,e.maxTotalSize=null,e.allowedFileTypes=null,e.filesContainer=null,e.messageContainer=null,e.innerFileInput=null,e.type="file",e}return i(f,[{key:"saveValueToTwin",value:function(){var e,t=new DataTransfer,i=s(this.files);try{for(i.s();!(e=i.n()).done;){var a=l(e.value,2),n=(a[0],a[1]);t.items.add(n)}}catch(e){i.e(e)}finally{i.f()}this.twin.files=t.files}},{key:"transformElementToHaiInput",value:(u=o(c().mark((function e(){var t,i,a,l,r,d,o,m,u,h,f,p=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.element.name,this.value="",this.rawValue="",(i=document.createElement("input")).name=t,i.type="file",i.hidden=!0,i.classList.add("hidden"),e.next=10,this.processAttributes();case 10:return e.next=12,this.processParameters();case 12:void 0!==t&&(this.element.removeAttribute("name"),i.name=t),this.disabled&&(i.disabled=!0),(a=document.createElement("div")).classList.add("hai-input-element"),a.classList.add("file"),(l=document.createElement("div")).classList.add("label-text"),(r=document.createElement("div")).classList.add("alert"),(d=document.createElement("div")).classList.add("file-zone-wrapper"),d.tabIndex=-1,!0===this.multiple?(d.classList.add("multiple"),i.multiple=!0,this.element.multiple=!0):(d.classList.add("single"),i.multiple=!1,this.element.multiple=!1),(o=document.createElement("div")).classList.add("message"),o.classList.add("active"),this.messageContainer=o,(m=document.createElement("strong")).textContent=n.dictionary["file-drop-placeholder"],(u=document.createElement("small")).textContent=n.dictionary["file-drop-second-placeholder"],o.appendChild(m),o.appendChild(u),d.appendChild(o),(h=document.createElement("ul")).classList.add("files"),this.filesContainer=h,d.appendChild(h),a.append(l,d,r,i),this.element.after(a),d.appendChild(this.element),this.twin=i,this.innerFileInput=this.element,this.element=d,this.labelElement=l,this.warningElement=r,void 0!==this.label&&(l.textContent=this.label),this.element.haiInput=this,this.innerFileInput.addEventListener("change",(function(e){var t,i=s(p.innerFileInput.files);try{for(i.s();!(t=i.n()).done;){var a=t.value;p.addFile(a)}}catch(e){i.e(e)}finally{i.f()}var l=new DataTransfer;p.innerFileInput.files=l.files})),this.addWrapperEvents(d),null!==(f=i.form)&&f.addEventListener("submit",(function(e){var t=p.checkValidity();return!1!==t.success||(e.preventDefault(),p.updateValidity(t,p.element),!1)}));case 54:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"addWrapperEvents",value:function(e){var t=this;e.addEventListener("dragover",(function(i){i.preventDefault(),t.warningElement.textContent="",e.classList.add("active-dragover")})),e.addEventListener("dragleave",(function(t){e.classList.remove("active-dragover")})),e.addEventListener("drop",(function(i){if(i.preventDefault(),e.classList.remove("active-dragover"),!t.readonly&&!t.disabled){var a,l=s(i.dataTransfer.files);try{for(l.s();!(a=l.n()).done;){var n=a.value;t.addFile(n)}}catch(e){l.e(e)}finally{l.f()}}})),e.addEventListener("click",(function(e){t.handleInput(e)}))}},{key:"checkFileValidity",value:function(e){if(null!==this.maxFilesCount&&this.maxFilesCount<this.files.size+1)return{success:!1,message:n.dictionary["max-files-count-exceeded"].replace("{{maxFilesCount}}",this.maxFilesCount)};if(null!==this.maxFileSize&&this.maxFileSize<e.size)return console.log(e.size,this.maxFileSize,this.formatBytes(e.size),this.formatBytes(this.maxFileSize)),{success:!1,message:n.dictionary["max-file-size-exceeded"].replace("{{maxFileSize}}",this.formatBytes(this.maxFileSize))};var t,i=e.size,a=s(this.files);try{for(a.s();!(t=a.n()).done;){var r=l(t.value,2);r[0];i+=r[1].size}}catch(e){a.e(e)}finally{a.f()}if(null!==this.maxTotalSize&&this.maxTotalSize<i)return{success:!1,message:n.dictionary["max-total-files-size-exceeded"].replace("{{maxTotalSize}}",this.formatBytes(this.maxTotalSize))};if(null!==this.allowedFileTypes){var d,o=!1,c=s(this.allowedFileTypes);try{for(c.s();!(d=c.n()).done;){var m=d.value;if(!0===/.*?\/\*/.test(m)&&e.type.startsWith(m.slice(0,m.length-2))||/.*?\/.*/.test(m)&&m===e.type||/^\..*/.test(m)&&e.name.endsWith(m)){o=!0;break}}}catch(e){c.e(e)}finally{c.f()}if(!1===o)return{success:!1,message:n.dictionary["not-allowed-file-type"]}}return{success:!0}}},{key:"checkValidity",value:function(){return!0===this.required&&""===this.rawValue?{success:!1,message:n.dictionary["file-required"]}:{success:!0}}},{key:"addFile",value:function(e){var t=this,i=this.checkFileValidity(e);if(!1!==i.success){if(!1===this.multiple){var a,l=s(this.files.keys());try{for(l.s();!(a=l.n()).done;){var n=a.value;this.removeFile(n)}}catch(e){l.e(e)}finally{l.f()}}var r=e.name;if(!0===this.files.has(r)){for(var d=1;!0===this.files.has("".concat(e.name," (").concat(d,")"));)d++;r="".concat(e.name," (").concat(d,")")}this.files.set(r,e),this.rawValue=Array.from(this.files.keys()).join(","),this.value=this.rawValue,this.saveValueToTwin(),this.messageContainer.classList.remove("active");var o=document.createElement("li");o.classList.add("file"),o.setAttribute("data-key",r);var c=document.createElement("figure");if(c.classList.add("file-preview"),!0===e.type.startsWith("image/")){var m=document.createElement("img");c.appendChild(m),this.loadImageToElement(e,m)}else{var u=document.createElement("div"),h=e.type.substring(e.type.indexOf("/")+1);u.classList.add("fi","fi-".concat(h));var f=document.createElement("div");f.classList.add("fi-content"),f.textContent=h,u.appendChild(f),c.appendChild(u)}var p=document.createElement("figcaption"),v=document.createElement("div");v.classList.add("name"),v.textContent=e.name,p.appendChild(v);var y=document.createElement("div");y.classList.add("size"),y.textContent=this.formatBytes(e.size),p.appendChild(y),c.appendChild(p),o.appendChild(c);var x=document.createElement("div");x.classList.add("close"),x.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M24 20.188l-8.315-8.209 8.2-8.282-3.697-3.697-8.212 8.318-8.31-8.203-3.666 3.666 8.321 8.24-8.206 8.313 3.666 3.666 8.237-8.318 8.285 8.203z"/></svg>',x.title="Remove file",o.appendChild(x),this.filesContainer.appendChild(o),x.addEventListener("click",(function(e){t.removeFile(r)}))}else this.warningElement.textContent=i.message}},{key:"removeFile",value:function(e){this.files.delete(e),this.rawValue=Array.from(this.files.keys()).join(","),this.value=this.rawValue,this.saveValueToTwin(),this.element.querySelector(".file[data-key='".concat(e,"']")).remove(),0===this.files.size&&this.messageContainer.classList.add("active")}},{key:"loadImageToElement",value:function(e,t){var i=new FileReader;i.addEventListener("load",(function(e){t.setAttribute("src",e.target.result)})),i.addEventListener("progress",(function(e){e.loaded&&e.total&&(e.loaded,e.total)})),i.readAsDataURL(e)}},{key:"processParameters",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===e&&(e=this.parameters),r(d(f.prototype),"processParameters",this).call(this,e),void 0!==e.multiple&&(this.multiple=Boolean(e.multiple)),void 0!==e.maxFilesCount&&(!0===isNaN(e.maxFilesCount)?console.warn('HaiForm: Parameter "maxFilesCount" must be a number.'):this.maxFilesCount=e.maxFilesCount),void 0!==e.maxFileSize&&(!0===isNaN(e.maxFileSize)?console.warn('HaiForm: Parameter "maxFileSize" must be a number.'):this.maxFileSize=e.maxFileSize),void 0!==e.maxTotalSize&&(!0===isNaN(e.maxTotalSize)?console.warn('HaiForm: Parameter "maxTotalSize" must be a number.'):this.maxTotalSize=e.maxTotalSize),void 0!==e.allowedFileTypes&&("string"==typeof e.allowedFileTypes&&(e.allowedFileTypes=e.allowedFileTypes.split(",")),Array.isArray(e.allowedFileTypes)?this.allowedFileTypes=e.allowedFileTypes:console.warn('HaiForm: Parameter "allowedFileTypes" must be an array or a string.'))}},{key:"handleInput",value:function(e){if(this.readonly||this.disabled)return{success:!1};if(this.warningElement.textContent="",e.target!==this.innerFileInput){var t=e.target.closest(".file");if(null!==t){if(null===t.parentElement)return;if(null!==t.parentElement.closest(".hai-input-element"))return}this.innerFileInput.click()}}},{key:"formatBytes",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===e)return"0 Bytes";var i=1024,a=t<0?0:t,s=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],l=Math.floor(Math.log(e)/Math.log(i));return parseFloat((e/Math.pow(i,l)).toFixed(a))+" "+s[l]}}]),f}();export{m as HaiInputFile};
