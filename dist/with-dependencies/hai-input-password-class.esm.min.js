/**
 * Hai Form (https://github.com/safraja/hai-form) - Javascript library for custom inputs and selects with additional functions.
 * Copyright (c) 2021 Jakub Šafránek All Rights Reserved
 * @license MIT Licensed
 */
import{_ as e,a as t,c as r,b as s,f as a,g as n,j as i,h as c,HaiInput as u,i as o}from"./hai-input-class.esm.min.js";import{HaiInputText as l}from"./hai-input-text-class.esm.min.js";import"./en.esm.min.js";var h=function(h){e(p,l);var d,m=t(p);function p(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r(this,p),(e=m.call(this,t,s)).minEntropy=null,e.requiredCharacters={lowercaseLetter:0,uppercaseLetter:0,number:0,special:0},e.minPasswordStrength=null,e.customPasswordCalcFun=null,e.entropy=0,e.passwordStrength=0,e.newPassword=!1,e.strengthInfoElement=null,e.runningCalc=null,e.nextCalc=null,e.type="password",e}return s(p,[{key:"transformElementToHaiInput",value:(d=c(o().mark((function e(){var t,r,s,a,n,i,c,u,l,h,d,m,p=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.element.name,this.element.removeAttribute("name"),this.element.type="password",this.element.haiInput=this,this.rawValue=this.extractRawValue(this.element.value),this.element.value=this.rawValue,this.value=this.formatValue(this.rawValue),(r=document.createElement("input")).name=t,r.type="password",r.hidden=!0,r.classList.add("hidden"),r.value=this.element.value,s=Math.floor(99999999*Math.random()+1),r.id="input-".concat(s),(a=document.createElement("div")).classList.add("hai-input-element"),n=document.createElement("label"),(i=document.createElement("div")).classList.add("label-text"),(c=document.createElement("div")).classList.add("input-wrapper"),!0===this.newPassword&&((u=document.createElement("div")).classList.add("strength-info"),(l=document.createElement("div")).classList.add("description"),(h=document.createElement("meter")).classList.add("meter"),h.min=0,h.max=5,h.optimum=5,h.low=3,h.high=3,h.value=0,u.append(l,h),this.strengthInfoElement=u),(d=document.createElement("div")).classList.add("alert"),a.append(n,r),this.element.parentElement.insertBefore(a,this.element),c.appendChild(this.element),n.append(i,c),null!==this.strengthInfoElement&&n.append(this.strengthInfoElement),n.append(d),this.twin=r,this.labelElement=i,this.warningElement=d,e.next=38,this.processAttributes();case 38:return e.next=40,this.processParameters();case 40:null!==this.placeholder&&(this.element.placeholder=this.placeholder),this.disabled&&(this.twin.disabled=!0),this.required&&(this.twin.required=!0),void 0!==this.label&&(this.labelElement.textContent=this.label),this.element.addEventListener("input",(function(e){p.handleInput(e)})),this.element.addEventListener("keydown",(function(e){p.handleKeyAction(e)})),this.element.addEventListener("focusout",(function(e){p.handleFocusOut(e)})),this.element.addEventListener("wheel",(function(e){p.handleWheel(e)})),null!==(m=r.form)&&m.addEventListener("submit",(function(e){var t=p.checkValidity();return!1!==t.success||(e.preventDefault(),p.updateValidity(t,p.element),!1)}));case 50:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"processParameters",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===e&&(e=this.parameters),a(n(p.prototype),"processParameters",this).call(this,e),void 0!==e.newPassword&&(this.newPassword=Boolean(e.newPassword)),void 0!==e.requiredCharacters&&("object"!==i(e.requiredCharacters)?console.warn('HaiForm: Parameter "requiredCharacters" must by an object.'):(void 0!==e.requiredCharacters.lowercaseLetter&&("number"!=typeof e.requiredCharacters.lowercaseLetter?console.warn('HaiForm: Parameter "requiredCharacters.lowercaseLetter" must be a number.'):this.requiredCharacters.lowercaseLetter=e.requiredCharacters.lowercaseLetter),void 0!==e.requiredCharacters.uppercaseLetter&&("number"!=typeof e.requiredCharacters.uppercaseLetter?console.warn('HaiForm: Parameter "requiredCharacters.uppercaseLetter" must be a number.'):this.requiredCharacters.uppercaseLetter=e.requiredCharacters.uppercaseLetter),void 0!==e.requiredCharacters.number&&("number"!=typeof e.requiredCharacters.number?console.warn('HaiForm: Parameter "requiredCharacters.number" must be a number.'):this.requiredCharacters.number=e.requiredCharacters.number),void 0!==e.requiredCharacters.special&&("number"!=typeof e.requiredCharacters.special?console.warn('HaiForm: Parameter "requiredCharacters.special" must be a number.'):this.requiredCharacters.special=e.requiredCharacters.special))),void 0!==e.minEntropy&&("number"!=typeof e.minEntropy||e.minEntropy<0?console.warn('HaiForm: Parameter "minEntropy" must be a non negative number.'):this.minEntropy=e.minEntropy),void 0!==e.minPasswordStrength&&("number"!=typeof e.minPasswordStrength||e.minPasswordStrength<0||e.minPasswordStrength>4?console.warn('HaiForm: Parameter "minEntropy" must be a number from 0 to 4 including.'):this.minPasswordStrength=e.minPasswordStrength),void 0!==e.customPasswordCalcFun&&("function"!=typeof e.customPasswordCalcFun?console.warn('HaiForm: Parameter "customPasswordCalcFun" must be a function.'):this.customPasswordCalcFun=e.customPasswordCalcFun),(this.minEntropy>0||this.requiredCharacters.lowercaseLetter>0||this.requiredCharacters.uppercaseLetter>0||this.requiredCharacters.number>0||this.requiredCharacters.special>0||this.minPasswordStrength>0)&&(this.required=!0)}},{key:"handleInput",value:function(e){var t=this;if(this.readonly||this.disabled)return e.target.value=this.value,{success:!1};var r=e.target.value;if(null!=this.mask&&(r=this.formatValueByMask(r)),this.value=r,this.rawValue=r,e.target.value=r,!0===this.newPassword){this.entropy=this.calcPasswordEntropy(r);var s=function(){var e=c(o().mark((function e(){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.checkPasswordStrength(),t.passwordStrength=r,t.updateStrengthInfo(r),null!=t.nextCalc?(t.runningCalc=c(o().mark((function e(){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.nextCalc,window.setTimeout(r,20);case 2:case"end":return e.stop()}}),e)}))),t.runningCalc(),t.nextCalc=null):t.runningCalc=null;case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();null==this.runningCalc?(this.runningCalc=c(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:window.setTimeout(s,20);case 1:case"end":return e.stop()}}),e)}))),this.runningCalc()):this.nextCalc=s}return this.saveValueToTwin(),{success:!0}}},{key:"calcPasswordEntropy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===e&&(e=this.value);var t=0;if(e.length>0){var r=0;/[0-9]/.test(e)&&(r+=10),/[a-z]/.test(e)&&(r+=26),/[A-Z]/.test(e)&&(r+=26),/[^a-zA-Z0-9]/.test(e)&&(r+=32),t=Math.floor(e.length*Math.log2(r))}return t}},{key:"checkPasswordStrength",value:function(){if(null!==this.customPasswordCalcFun){if("function"==typeof this.customPasswordCalcFun)return this.customPasswordCalcFun(this.value);console.warn("HaiForm: attribute customFunction must be a function, reverting back to default.")}return this.entropy<28?0:this.entropy<36?1:this.entropy<60?2:this.entropy<128?3:4}},{key:"checkValidity",value:function(){var e=a(n(p.prototype),"checkValidity",this).call(this);return!1===e.success?e:!1===this.newPassword?{success:!0}:this.requiredCharacters.lowercaseLetter>this.countOccurrences(this.value,/[a-z]/g)?{success:!1,message:u.dictionary["min-lowercase-letters"].replace("{{lowercaseLetter}}",this.requiredCharacters.lowercaseLetter)}:this.requiredCharacters.uppercaseLetter>this.countOccurrences(this.value,/[A-Z]/g)?{success:!1,message:u.dictionary["min-lowercase-letters"].replace("{{uppercaseLetter}}",this.requiredCharacters.uppercaseLetter)}:this.requiredCharacters.number>this.countOccurrences(this.value,/[0-9]/g)?{success:!1,message:u.dictionary["min-numbers"].replace("{{number}}",this.requiredCharacters.number)}:this.requiredCharacters.special>this.countOccurrences(this.value,/[^a-zA-Z0-9]/g)?{success:!1,message:u.dictionary["min-special-characters"].replace("{{special}}",this.requiredCharacters.special)}:null!=this.minEntropy&&(this.entropy=this.calcPasswordEntropy(),this.entropy<this.minEntropy)||null!=this.minPasswordStrength&&(this.entropy=this.calcPasswordEntropy(),this.passwordStrength=this.checkPasswordStrength(),this.passwordStrength<this.minPasswordStrength)?{success:!1,message:u.dictionary["weak-password"]}:{success:!0}}},{key:"updateStrengthInfo",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===t&&(t=this.passwordStrength);var r=["Very weak","Weak","Reasonable","Strong","Very strong"];e=r[t],this.strengthInfoElement.querySelector(".description").textContent=e,""!==this.value?this.strengthInfoElement.querySelector(".meter").value=t+1:this.strengthInfoElement.querySelector(".meter").value=0}},{key:"countOccurrences",value:function(e,t){var r=e.match(t);return null===r?0:r.length}}]),p}();export{h as HaiInputPassword};
