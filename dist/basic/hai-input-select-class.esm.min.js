/**
 * Hai Form (https://github.com/safraja/hai-form) - Javascript library for custom inputs and selects with additional functions.
 * Copyright (c) 2021 Jakub Šafránek All Rights Reserved
 * @license MIT Licensed
 */
import{_ as e,a as t,c as n,b as a,d as s,e as i,HaiInput as l,h as o,i as r,j as u,f as d,g as c}from"./hai-input-class.esm.min.js";import p from"fuse.js";import"./en.esm.min.js";var h=function(h){e(b,l);var v,m,f,y=t(b);function b(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n(this,b),(e=y.call(this,t,a)).options=new Map,e.optionsSource=null,e.optGroups=new Set,e.selectedOptions=new Map,e.valuesSet=new Set,e.multiple=!1,e.showTagRemoveButton=!0,e.enableSearch=!0,e.placeholder=null,e.tabIndex=0,e.optionsItemsContainer=null,e.tagsContainer=null,e.searchInput=null,e.inputText=null,e.type="select",e}return a(b,[{key:"transformElementToHaiInput",value:(f=o(r().mark((function e(){var t,n,a,i,o,u,d,c,p,h,v,m,f,y,b,g,O,w,k,E,L,x,S,C=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.element.name,this.value=this.element.value,this.rawValue=this.value,n=document.createElement("select"),void 0!==t&&(this.element.removeAttribute("name"),n.name=t),n.hidden=!0,n.classList.add("hidden"),this.processElementContentAndAttributes(this.element),e.next=10,this.processAttributes();case 10:return e.next=12,this.processParameters();case 12:if(this.disabled&&(n.disabled=!0),(a=document.createElement("div")).classList.add("hai-input-element"),a.classList.add("select"),(i=document.createElement("div")).classList.add("label-text"),(o=document.createElement("div")).classList.add("alert"),(u=document.createElement("div")).classList.add("select-wrapper"),u.tabIndex=-1,!0===this.multiple?u.classList.add("multiple"):u.classList.add("single"),(d=document.createElement("div")).classList.add("input-field"),d.tabIndex=this.tabIndex,u.appendChild(d),!0===this.multiple){(c=document.createElement("ul")).classList.add("tags"),null!==this.placeholder&&c.setAttribute("data-placeholder",this.placeholder),this.tagsContainer=c,d.appendChild(c),p=s(this.selectedOptions.values());try{for(p.s();!(h=p.n()).done;)v=h.value,this.addTag(v,c)}catch(e){p.e(e)}finally{p.f()}}else(m=document.createElement("span")).classList.add("input-text"),d.appendChild(m),this.inputText=m,this.selectedOptions.size>0&&(f=Array.from(this.selectedOptions.values())[0],m.textContent=f.label,m.setAttribute("data-value",f.value));(y=document.createElement("div")).classList.add("dropdown"),(b=document.createElement("ul")).classList.add("options-container"),this.optionsItemsContainer=b,y.appendChild(b),(g=document.createElement("div")).classList.add("info"),y.appendChild(g),(O=document.createElement("div")).classList.add("control-buttons"),y.appendChild(O),(w=document.createElement("div")).classList.add("button"),w.textContent="Confirm",O.appendChild(w),w.addEventListener("click",(function(e){C.hideDropdown(e)})),u.appendChild(y),a.append(i,u,o),this.element.after(a),this.element.remove(),this.element=u,this.element.haiInput=this,this.renderOptionsItems(this.options,b),k=Math.floor(99999999*Math.random()+1),n.id="select-".concat(k),!0===this.multiple&&(n.multiple=!0),this.element.parentElement.appendChild(n),this.twin=n,this.labelElement=i,this.warningElement=o,void 0!==this.label&&(this.labelElement.textContent=this.label),this.setTwinOptions(),!0===this.enableSearch&&((E=document.createElement("div")).classList.add("search-container"),(L=document.createElement("input")).placeholder=l.dictionary["search-placeholder"],this.searchInput=L,E.appendChild(L),y.prepend(E),d.addEventListener("click",(function(e){L.focus()})),L.addEventListener("input",(function(e){C.useFuseSearch(e)}))),this.element.addEventListener("focusin",(function(e){C.showDropdown(e),e.target===d&&C.element.focus()})),x=function(e){C.hideDropdown(e)},this.element.addEventListener("blur",x),null!==this.searchInput&&this.searchInput.addEventListener("blur",x),this.element.removeEventListener("blur",this.hideDropdown),null!==this.searchInput&&this.searchInput.removeEventListener("blur",this.hideDropdown),null!==(S=n.form)&&S.addEventListener("submit",(function(e){return!1!==C.checkValidity().success||(e.preventDefault(),!1)}));case 73:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"useFuseSearch",value:function(e){var t=e.target.value;if(""!==t){var n,a=new p(Array.from(this.options.values()),{keys:["label","value","group"],threshold:.45}).search(t),i=new Map,l=s(a);try{for(l.s();!(n=l.n()).done;){var o=n.value;i.set(this.generateOptionKey(o.item),o.item)}}catch(e){l.e(e)}finally{l.f()}this.renderOptionsItems(i)}else this.renderOptionsItems()}},{key:"processElementContentAndAttributes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null===e&&(e=this.element),"SELECT"===e.nodeName){var t=e.querySelectorAll("optgroup"),n=e.options;if(0===t.length){var a,i=s(n);try{for(i.s();!(a=i.n()).done;){var l=a.value;this.options.set(this.generateOptionKey(l),{value:l.value,label:l.label})}}catch(e){i.e(e)}finally{i.f()}}else{var o,r=s(t);try{for(r.s();!(o=r.n()).done;){var u=o.value;this.optGroups.add(u.label)}}catch(e){r.e(e)}finally{r.f()}var d,c=s(n);try{for(c.s();!(d=c.n()).done;){var p=d.value;"OPTGROUP"===p.parentElement.nodeName?this.options.set(this.generateOptionKey(p),{value:p.value,label:p.label,group:p.parentElement.label}):this.options.set(this.generateOptionKey(p),{value:p.value,label:p.label})}}catch(e){c.e(e)}finally{c.f()}}var h,v=e.selectedOptions,m=s(v);try{for(m.s();!(h=m.n()).done;){var f=h.value;"OPTGROUP"===f.parentElement.nodeName?this.selectedOptions.set(this.generateOptionKey(f),{value:f.value,label:f.label,group:f.parentElement.label}):this.selectedOptions.set(this.generateOptionKey(f),{value:f.value,label:f.label}),this.valuesSet.add(f.value)}}catch(e){m.e(e)}finally{m.f()}this.value=Array.from(this.valuesSet.values()).join(","),this.rawValue=this.value}}},{key:"processParameters",value:(m=o(r().mark((function e(){var t,n,a,l,o,p,h,v,m,f,y,g,O,w,k,E,L,x=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=x.length>0&&void 0!==x[0]?x[0]:null)&&(t=this.parameters),d(c(b.prototype),"processParameters",this).call(this,t),void 0!==t.multiple&&(this.multiple=Boolean(t.multiple)),void 0!==t.enableSearch&&(this.enableSearch=Boolean(t.enableSearch)),void 0!==t.placeholder&&("string"!=typeof t.placeholder?console.warn('HaiForm: Parameter "placeholder" must be a string.'):this.placeholder=t.placeholder),void 0!==t.list&&void 0===t.options)if("string"!=typeof t.list)console.warn("HaiForm: List parameter must by a string.");else if(null===(n=document.getElementById(t.list)))console.warn("HaiForm: Datalist with id ".concat(t.list," was not found."));else{a=n.options,l=s(a);try{for(l.s();!(o=l.n()).done;)p=o.value,h={value:p.value,label:p.label},null!==p.getAttribute("data-group")&&(v=p.getAttribute("data-group"),this.optGroups.add(v),h.group=v),this.options.set(this.generateOptionKey(p),h),null!==p.getAttribute("data-selected")&&(!1===this.multiple&&this.selectedOptions.clear(),this.selectedOptions.set(this.generateOptionKey(p),h))}catch(e){l.e(e)}finally{l.f()}}if(void 0===t.optionsSource){e.next=15;break}if("string"==typeof t.optionsSource){e.next=12;break}console.warn('HaiForm: Parameter "optionsSource" must be a string.'),e.next=15;break;case 12:return e.next=14,this.fetchFile(t.optionsSource);case 14:t.options=e.sent;case 15:if(void 0===t.options){e.next=76;break}if(!(t.options instanceof Map)){e.next=47;break}m=s(t.options),e.prev=18,m.s();case 20:if((f=m.n()).done){e.next=37;break}if(y=i(f.value,2),g=y[0],O=y[1],"object"===u(O)){e.next=25;break}return console.warn('HaiForm: Parameter "options" must contain only objects if given as Map. Option skipped.'),e.abrupt("continue",35);case 25:if(void 0!==O.value){e.next=28;break}return console.warn('HaiForm: Each option given by parameter "options" must have a "value" property. Option skipped.'),e.abrupt("continue",35);case 28:if(void 0!==O.label){e.next=31;break}return console.warn('HaiForm: Each option given by parameter "options" must have a "label" property. Option skipped.'),e.abrupt("continue",35);case 31:O.key=g,this.options.set(g,O),!0===O.selected&&(!1===this.multiple&&(this.selectedOptions.clear(),this.valuesSet.clear()),this.selectedOptions.set(g,O),this.valuesSet.add(O.value),this.value=Array.from(this.valuesSet.values()).join(","),this.rawValue=this.value),void 0!==O.group&&this.optGroups.add(O.group);case 35:e.next=20;break;case 37:e.next=42;break;case 39:e.prev=39,e.t0=e.catch(18),m.e(e.t0);case 42:return e.prev=42,m.f(),e.finish(42);case 45:e.next=76;break;case 47:if(!1!==Array.isArray(t.options)){e.next=51;break}console.warn('HaiForm: Parameter "options" must be either a Map or an array of objects.'),e.next=76;break;case 51:w=s(t.options),e.prev=52,w.s();case 54:if((k=w.n()).done){e.next=68;break}if(void 0!==(E=k.value).value){e.next=59;break}return console.warn('HaiForm: Each option given by parameter "options" must have a "value" property. Option skipped.'),e.abrupt("continue",66);case 59:if(void 0!==E.label){e.next=62;break}return console.warn('HaiForm: Each option given by parameter "options" must have a "label" property. Option skipped.'),e.abrupt("continue",66);case 62:L=this.generateOptionKey(E),this.options.set(L,E),!0===E.selected&&(!1===this.multiple&&(this.selectedOptions.clear(),this.valuesSet.clear()),this.selectedOptions.set(L,E),this.valuesSet.add(E.value),this.value=Array.from(this.valuesSet.values()).join(","),this.rawValue=this.value),void 0!==E.group&&this.optGroups.add(E.group);case 66:e.next=54;break;case 68:e.next=73;break;case 70:e.prev=70,e.t1=e.catch(52),w.e(e.t1);case 73:return e.prev=73,w.f(),e.finish(73);case 76:case"end":return e.stop()}}),e,this,[[18,39,42,45],[52,70,73,76]])}))),function(){return m.apply(this,arguments)})},{key:"showDropdown",value:function(e){var t=this.element.querySelector(".dropdown");if(!t.matches(".active")){t.classList.add("active");var n=window.getComputedStyle(document.documentElement).getPropertyValue("--hai-input-mobile-threshold");window.matchMedia("(max-width: ".concat(n,")")).matches&&this.element.classList.add("dialog-display")}}},{key:"hideDropdown",value:function(e){var t=this.element.querySelector(".dropdown");!1===e.currentTarget.contains(e.relatedTarget)&&(t.classList.remove("active"),this.element.classList.remove("dialog-display"))}},{key:"handleInput",value:function(e){if(this.readonly||this.disabled)return{success:!1};var t;t=e.target.matches(".option")?e.target:e.target.closest(".option");var n=this.options.get(t.getAttribute("data-key"));return this.isSelected(n)?this.unselectOption(n):this.selectOption(n),{success:!0}}},{key:"selectOption",value:function(e){!0===this.multiple?(this.valuesSet.add(e.value),this.selectedOptions.set(this.generateOptionKey(e),e),this.value=Array.from(this.valuesSet.values()).join(","),this.rawValue=this.value,this.setTwinOptions(),this.addTag(e)):(this.inputText.textContent=e.label,this.inputText.setAttribute("data-value",e.value),this.showAllOptionItems(),this.valuesSet.clear(),this.selectedOptions.clear(),this.valuesSet.add(e.value),this.selectedOptions.set(this.generateOptionKey(e),e),this.value=e.value,this.rawValue=this.value,this.setTwinOptions()),this.hideOptionItem(e),null!==this.searchInput&&""!==this.searchInput.value&&(this.searchInput.value="",this.renderOptionsItems(),this.searchInput.focus()),!1===this.multiple&&(this.element.querySelector(".dropdown").classList.remove("active"),this.element.classList.remove("dialog-display"))}},{key:"unselectOption",value:function(e){if(!1===this.multiple)return this.element.querySelector(".dropdown").classList.remove("active"),void this.element.classList.remove("dialog-display");this.selectedOptions.delete(this.generateOptionKey(e)),this.valuesSet.delete(e.value),this.value=Array.from(this.valuesSet.values()).join(","),this.rawValue=this.value,this.setTwinOptions(),this.removeTag(e),this.showOptionItem(e)}},{key:"setTwinOptions",value:function(){this.twin.innerHTML="";var e,t=s(this.selectedOptions.values());try{for(t.s();!(e=t.n()).done;){var n=e.value,a=document.createElement("option");a.value=n.value,a.textContent=n.label,a.selected=!0,this.twin.appendChild(a)}}catch(e){t.e(e)}finally{t.f()}}},{key:"addTag",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===n&&(n=this.tagsContainer);var a=document.createElement("li");a.classList.add("tag"),a.setAttribute("data-key",this.generateOptionKey(e));var s=document.createElement("span");if(s.textContent=e.label,a.appendChild(s),!0===this.showTagRemoveButton){var i=document.createElement("button");i.textContent="×",i.classList.add("remove"),i.addEventListener("click",(function(n){t.readonly||t.disabled||(t.unselectOption(e),a.remove())})),a.appendChild(i)}n.appendChild(a)}},{key:"removeTag",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===t&&(t=this.tagsContainer);var n=t.querySelector(".tag[data-key='".concat(this.generateOptionKey(e),"']"));null!==n&&n.remove(),null!==this.searchInput&&this.searchInput.focus()}},{key:"renderOptionsItems",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===e&&(e=this.options),null===t&&(t=this.optionsItemsContainer),null===n&&(n=this.optGroups),t.innerHTML="";var a=this.element.querySelector(".dropdown .info");if(0===e.size)return a.classList.add("active"),void(a.textContent="No options found");if(a.classList.remove("active"),0===n.size){var l,o=s(e);try{for(o.s();!(l=o.n()).done;){var r=i(l.value,2),u=r[0],d=r[1];this.addOptionItem(d,u,t)}}catch(e){o.e(e)}finally{o.f()}}else{var c,p=new Map(e),h=s(n);try{for(h.s();!(c=h.n()).done;){var v=c.value,m=document.createElement("li");m.classList.add("option-group-header");var f=document.createElement("strong");f.textContent=v,m.appendChild(f),t.appendChild(m);var y,b=0,g=0,O=s(p);try{for(O.s();!(y=O.n()).done;){var w=i(y.value,2),k=w[0],E=w[1];E.group===v&&(this.addOptionItem(E,k,t),p.delete(k),!1===this.isSelected(E)&&b++,g++)}}catch(e){O.e(e)}finally{O.f()}0===g?m.remove():m.setAttribute("data-unselected-options","".concat(b))}}catch(e){h.e(e)}finally{h.f()}if(p.size>0){var L=document.createElement("li");L.classList.add("option-group-header");var x=document.createElement("strong");L.appendChild(x),t.appendChild(L);var S,C=s(p);try{for(C.s();!(S=C.n()).done;){var I=i(S.value,2),A=I[0],T=I[1];this.addOptionItem(T,A,t)}}catch(e){C.e(e)}finally{C.f()}}}}},{key:"addOptionItem",value:function(e,t){var n=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===a&&(a=this.optionsItemsContainer);var s=document.createElement("li");s.classList.add("option"),s.setAttribute("data-key",t),s.setAttribute("data-value",e.value);var i=document.createElement("span");null!==e.label&&(i.textContent=e.label),this.isSelected(e)&&s.classList.add("selected"),s.addEventListener("click",(function(e){n.handleInput(e)})),s.append(i),a.appendChild(s)}},{key:"removeOptionItem",value:function(e){var t=this.optionsItemsContainer.querySelector(".option[data-key='".concat(this.generateOptionKey(e),"']"));null!==t&&t.remove()}},{key:"hideOptionItem",value:function(e){var t=this.optionsItemsContainer.querySelector(".option[data-key='".concat(this.generateOptionKey(e),"']"));null!==t&&(t.classList.add("selected"),void 0!==e.group&&this.updateGroupHeaderUnselectedOpt(t,-1))}},{key:"showAllOptionItems",value:function(){var e,t=this.optionsItemsContainer.querySelectorAll(".option.selected"),n=s(t);try{for(n.s();!(e=n.n()).done;){var a=e.value;a.matches(".selected")&&(a.classList.remove("selected"),0!==this.optGroups.length&&this.updateGroupHeaderUnselectedOpt(a,1))}}catch(e){n.e(e)}finally{n.f()}}},{key:"showOptionItem",value:function(e){var t=this.optionsItemsContainer.querySelector(".option[data-key='".concat(this.generateOptionKey(e),"']"));null!==t&&(t.classList.remove("selected"),void 0!==e.group&&this.updateGroupHeaderUnselectedOpt(t,1))}},{key:"updateGroupHeaderUnselectedOpt",value:function(e,t){for(var n,a=e.previousElementSibling;null!==a;){if(a.matches(".option-group-header")){n=a;break}a=a.previousElementSibling}if(void 0!==n){var s=parseInt(n.getAttribute("data-unselected-options"));s+=t,n.setAttribute("data-unselected-options","".concat(s))}}},{key:"isSelected",value:function(e){return this.selectedOptions.has(this.generateOptionKey(e))}},{key:"generateOptionKey",value:function(e){return void 0!==e.key?e.key:"".concat(e.label," (").concat(e.value,")")}},{key:"fetchFile",value:(v=o(r().mark((function e(t){var n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)}))),function(e){return v.apply(this,arguments)})}]),b}();export{h as HaiInputSelect};
